# Claw-Empire v1.2.1 Release Notes

- Release date: 2026-02-26
- Scope: Post-v1.2.0 hardening and maintainability release focused on CI reliability, runtime safety, type debt reduction, and documentation/API discoverability.

## Highlights

### Core Hotfixes

- **Task route split recovery**: Fixed production build/runtime breakage by restoring missing core task route registrations after modular split (`crud`, `execution`, `subtasks`) in the main route wiring.
- **Workflow Unicode guard**: Added CI protection against hidden/bidi Unicode characters in `.github/workflows/*.yml` to mitigate Trojan Source-style risks.

### CI and Toolchain Hardening

- **pnpm version alignment**: Removed conflicting pnpm version declarations between workflow and `packageManager`, resolving `ERR_PNPM_BAD_PM_VERSION` class failures.
- **Trigger coverage update**: CI now runs on `push` to `main`, `pull_request`, and manual dispatch.
- **Least privilege**: Explicit `permissions: { contents: read }` applied to CI workflow.
- **Explicit build gates**:
  - `pnpm exec tsc -p tsconfig.json --noEmit`
  - `pnpm run build`
- **Formatting enforcement reliability**: Repository-wide Prettier normalization to satisfy `format:check` deterministically in CI.

### Lint Baseline and Gradual Tightening

- **ESLint Flat Config rollout** with TypeScript and React Hooks coverage in CI.
- **Safe warning cleanup pass** across runtime/orchestration hotspots (empty blocks, useless escapes where safely removable, and related non-behavioral lint debt).
- **Incremental strictness path** introduced via `lint-staged` for staged-file quality gates (targeted tightening without forcing full-repo churn).

### RuntimeContext and Type-Debt Refactor

- **Dependency-surface reduction** across route modules to reduce giant runtime context coupling and improve reviewability.
- **Decision Inbox type unification**:
  - Removed duplicated `DecisionInboxRouteItem` declaration.
  - Consolidated shared type usage through `decision-inbox/types.ts`.
- **App orchestration extraction**:
  - Added `src/app/useAppBootstrapData.ts` for initial bootstrap fetch/sync logic.
  - Added `src/app/useLiveSyncScheduler.ts` for live sync scheduling and dedup logic.
  - Reduced logic density in `src/App.tsx` without changing user-facing behavior.

### Test Runtime Safety

- **Test DB/runtime isolation hardening**:
  - Reinforced separation of test runtime data from production runtime paths.
  - Added setup-level safety posture for future integration tests to prevent accidental production DB usage.

### API and Security Documentation Surface

- **Swagger/OpenAPI route exposure**: Added Swagger documentation endpoint with linked OpenAPI spec (`docs/openapi.json`) for contract visibility.
- **Documentation refresh**:
  - Updated multilingual READMEs (`README.md`, `README_ko.md`, `README_jp.md`, `README_zh.md`).
  - Added CI status badges and current CI validation flow.
  - Added clear links to API docs and `SECURITY.md`.

## Notable Files and Areas

- CI / workflow:
  - `.github/workflows/ci.yml`
- Quality/tooling:
  - `eslint.config.mjs`
  - `package.json`
  - `pnpm-lock.yaml`
- Runtime/routes refactor and type cleanup:
  - `server/modules/routes/core.ts`
  - `server/modules/routes/ops/messages/decision-inbox-routes.ts`
  - `server/modules/routes/ops/messages/decision-inbox/types.ts`
  - `server/modules/routes/**` (dependency-surface narrowing series)
- App orchestration split:
  - `src/App.tsx`
  - `src/app/useAppBootstrapData.ts`
  - `src/app/useLiveSyncScheduler.ts`
- Docs/API/security:
  - `docs/api.md`
  - `docs/openapi.json`
  - `SECURITY.md`
  - `README*.md`

## Verification Summary

- Local quality/build checks executed during stabilization:
  - `pnpm run lint` (passes with warnings policy)
  - `pnpm run build` (passes)
- CI workflow now includes explicit format, lint, typecheck, build, and test gates with pnpm-version consistency and minimum permissions.

